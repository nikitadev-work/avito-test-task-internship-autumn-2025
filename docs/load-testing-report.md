# Load Testing Report

Проект: PR Manager Service — Avito Test Task (Internship Autumn 2025)  
Инструмент нагрузочного тестирования: k6  
Целевые SLI из задания:
- RPS: 5 запросов в секунду.
- SLI по времени ответа: 300 мс.
- SLI по успешности: 99.9 %.

Ниже приведены результаты для двух сценариев нагрузочного тестирования.

---

## 1. Сценарий: создание pull request’ов

Скрипт: `ops/load-testing/k6_create_pr.js`  
Команда запуска:

```bash
make load-create-pr
```

Параметры сценария:
- executor: `constant-arrival-rate`
- скорость: ~5 запросов/с (`5.00 iterations/s`)
- длительность: 2 минуты
- VUs: 10 (max 10–20)

Фрагмент вывода k6:

```text
scenarios: (100.00%) 1 scenario, 20 max VUs, 2m30s max duration (incl. graceful stop):
         * create_pr: 5.00 iterations/s for 2m0s (maxVUs: 10-20, gracefulStop: 30s)

checks_total.......: 600     4.999971/s
checks_succeeded...: 100.00% 600 out of 600
checks_failed......: 0.00%   0 out of 600

✓ status is 201 or 400

HTTP
http_req_duration..............: avg=5.5ms    min=2.87ms   med=5.32ms  max=9.94ms   p(90)=6.77ms   p(95)=7.66ms
  { expected_response:true }...: avg=5.5ms    min=2.87ms   med=5.32ms  max=9.94ms   p(90)=6.77ms   p(95)=7.66ms
http_req_failed................: 0.00%  0 out of 600
http_reqs......................: 600    4.999971/s
```

Ключевые метрики:

- Общее количество запросов: **600**.
- RPS: **≈5 запросов/с** (`http_reqs: 600 4.999971/s`).
- Успешность проверок: **100 %** (`checks_succeeded: 600 out of 600`).
- Ошибки HTTP: **0 %** (`http_req_failed: 0.00 %`).
- Время ответа:
  - `p(95) = 7.66 ms` (95-й процентиль).
  - Максимальное время: `9.94 ms`.

Сопоставление с SLI:

- RPS 5 — выдержан.
- SLI времени ответа 300 мс — фактический p95 ≈ 7.66 мс (запас по порядку величины).
- SLI успешности 99.9 % — фактически 100 % успешных ответов.

Вывод по сценарию `create_pr`:

- Сервис стабильно обрабатывает ~5 запросов/с на `POST /pullRequest/create`.
- При таком профиле нагрузки время ответа намного меньше 300 мс.
- Отказов и ошибок на уровне HTTP не наблюдается.

---

## 2. Сценарий: получение ревью пользователя

Скрипт: `ops/load-testing/k6_get_reviews.js`  
Команда запуска:

```bash
make load-get-reviews
```

Параметры сценария:
- executor: `constant-arrival-rate`
- скорость: ~5 запросов/с (`5.00 iterations/s`)
- длительность: 2 минуты
- VUs: 5 (max 5–10)

Фрагмент вывода k6:

```text
scenarios: (100.00%) 1 scenario, 10 max VUs, 2m30s max duration (incl. graceful stop):
         * get_reviews: 5.00 iterations/s for 2m0s (maxVUs: 5-10, gracefulStop: 30s)

checks_total.......: 601     5.003922/s
checks_succeeded...: 100.00% 601 out of 601
checks_failed......: 0.00%   0 out of 601

✓ status is 200

HTTP
http_req_duration..............: avg=6.33ms   min=3.52ms   med=4.61ms   max=26.67ms  p(90)=11.8ms   p(95)=14.59ms
  { expected_response:true }...: avg=6.33ms   min=3.52ms   med=4.61ms   max=26.67ms  p(90)=11.8ms   p(95)=14.59ms
http_req_failed................: 0.00% 0 out of 601
http_reqs......................: 601   5.003922/s
```

Ключевые метрики:

- Общее количество запросов: **601**.
- RPS: **≈5 запросов/с** (`http_reqs: 601 5.003922/s`).
- Успешность проверок: **100 %** (`checks_succeeded: 601 out of 601`).
- Ошибки HTTP: **0 %** (`http_req_failed: 0.00 %`).
- Время ответа:
  - `p(95) = 14.59 ms` (95-й процентиль).
  - Максимальное время: `26.67 ms`.

Сопоставление с SLI:

- RPS 5 — выдержан.
- SLI времени ответа 300 мс — фактический p95 ≈ 14.59 мс (значительно ниже целевого порога).
- SLI успешности 99.9 % — фактически 100 % успешных ответов.

Вывод по сценарию `get_reviews`:

- Эндпоинт `GET /users/getReview` под нагрузкой 5 rps показывает стабильное время ответа на уровне десятков миллисекунд.
- Ошибок и таймаутов не зафиксировано, все проверки проходят успешно.

---

## 3. Итоговые выводы по нагрузочному тестированию

1. Оба протестированных эндпоинта:
   - `POST /pullRequest/create`
   - `GET /users/getReview`

   при нагрузке около **5 запросов/с** демонстрируют:
   - время ответа **значительно ниже целевого SLI 300 мс** (p95 < 15 мс),
   - **0 % ошибок HTTP**,
   - **100 % успешных проверок** на уровне k6.

2. Наблюдаемые значения p95 по времени ответа находятся в диапазоне **7–15 мс**, что даёт большой запас по производительности относительно требований тестового задания.

3. При необходимости нагрузку можно увеличивать (rate, количество VU), но уже текущие результаты показывают, что для заявленных объёмов данных (до 20 команд и до 200 пользователей) сервис устойчиво выдерживает целевые SLI.

4. Нагрузочное тестирование было проведено для двух основных сценариев:
   - создание PR (запись + бизнес-логика распределения ревьюеров),
   - чтение ревью по пользователю (чтение и агрегация данных).